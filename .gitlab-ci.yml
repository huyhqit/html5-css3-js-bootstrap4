image: phusion/passenger-nodejs
cache:
  paths:
  - node_modules/
  - ~/.cache/pip
before_script:
- apt-get -yqq update
- DEBIAN_FRONTEND=noninteractive apt-get -o dir::cache::archives="apt-cache" -yqq install calibre python3-pip < /dev/null > /dev/null
- pip3 install sphinx sphinx_rtd_theme recommonmark --quiet
- npm install --silent
pages:
  script:
  - ./node_modules/.bin/gitbook build ./ public/gitbook-html
  - ./node_modules/.bin/gitbook pdf ./ ./public/ebooks/ebook.pdf
  - ./node_modules/.bin/gitbook epub ./ ./public/ebooks/ebook.epub
  - ./node_modules/.bin/gitbook mobi ./ ./public/ebooks/ebook.mobi
  - sphinx-build -b html ./ ./public/readthedocs-html
  artifacts:
    paths:
    - public
  only:
    - master
